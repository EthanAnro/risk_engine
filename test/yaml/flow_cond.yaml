key: flow_conditional
version: 1.0
label: 条件决策流
metadata:
decision_flow:
  - flow_node:
    node_name: start_1
    node_type: start
    next_node_name: conditional_1
    next_node_type: conditional
  - flow_node:
    node_name: conditional_1
    node_type: conditional
    next_node_name:
    next_node_type:
  - flow_node:
    node_name: ruleset_1
    node_type: ruleset
    next_node_name: end_1
    next_node_type: end
  - flow_node:
    node_name: ruleset_2
    node_type: ruleset
    next_node_name: end_1
    next_node_type: end
  - flow_node:
    node_name: end_1
    node_type: end
    next_node_name: ""
    next_node_type: ""
rulesets:
  - ruleset:
    name: ruleset_1
    tag: internal
    label: 内部规则集1
    kind: ruleset
    depends: [feature_1,feature_2,feature_e]
    exec_plan: parallel
    rules: 
    - rule: 
      name: rule_1
      tag: tag1
      label: 规则1
      conditions:
      - condition:
        name: c1
        feature: feature_1
        operator: GT
        value: 50
      decision:
        depends: [c1]
        logic: c1
        output: reject
        assign:
          feature_x: 111
    - rule: 
      name: rule_2
      tag: tag2
      label: 规则2
      conditions:
      - condition:
        name: c2
        feature: feature_2
        operator: LT
        value: 18
      - condition:
        name: c3
        feature: feature_3
        operator: GT
        value: 50
      decision: 
        depends: [c2, c3]
        logic: c2 || c3
        output: record
        assign:
  - ruleset:
    name: ruleset_2
    tag: internal
    label: 内部规则集2
    kind: ruleset
    depends: [feature_1,feature_2,feature_3]
    exec_plan: serial
    rules: 
    - rule: 
      name: rule_3
      tag: rule_3
      label: 规则3
      conditions:
      - condition:
        name: c3
        feature: feature_1
        operator: GT
        value: 5
      decision: 
        depends: [c3]
        logic: c3
        output: record
        assign:
    - rule: 
      name: rule_4
      tag: rule_4
      label: 规则4
      conditions:
      - condition:
        name: c4
        feature: feature_2
        operator: LT
        value: 8
      - condition:
        name: c5
        feature: feature_3
        operator: GT
        value: 9
      decision: 
        depends: [c4, c5]
        logic: c4 || c5
        output: record
        assign:
abtests:
  - abtest:
    name: abtest_1 
    tag: tag_ab
    label: 分流实验
    kind: abtest
    output_name: my_abtest_1
    branchs:
    - branch:
      branch_name: branch_1
      percent: 44.5
      decision:
        output: [ruleset_1, ruleset]
    - branch:
      branch_name: branch_2
      percent: 55.5
      decision:
        output: [ruleset_2, ruleset]
